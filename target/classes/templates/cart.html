<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cart</title>
    <link rel="stylesheet" th:href="@{/css/cart.css}">
	<style>
	       input[type="radio"] {
	           margin-right: 8px;
	           accent-color: #3399cc;
	       }
	       label {
	           font-size: 16px;
	           cursor: pointer;
	           display: block;
	           margin-bottom: 10px;
	       }
	       .payment-options {
	           margin-top: 20px;
	       }
	   </style>

</head>
<body>
	<nav class="navbar">
	        <div class="navbar-left">
	            <a href="#" class="navbar-brand">Ecommerce App</a>
	            <ul class="nav-links">
	                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="/userhome" class="active">Home</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	                <li><a href="/aboutus">About Us</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	                <li><a href="/contactus">Contact Us</a></li>
	                <form action="/product/search" method="post">
	                    <input type="text" name="name" placeholder="Search">
	                    <button style="all: unset" type="submit">
	                        <img src="/img/download (4).png" width="23px" height="23px">
	                    </button>
	                </form>
					<form action="/user/cart">
						<button style="all: unset; margin-left: 480px;" type="submit">
						    <img src="/img/cart.png" width="30px" height="30px">
						</button></form>
	            </ul>
	        </div>
	        <a href="/login" class="login-btn">Logout</a>
	    </nav>
    <div class="cart-container">
		<form action="/place/order" method="post">
		    <input type="hidden" name="productId" th:value="${order.product.id}">
		    <input type="hidden" name="quantity" th:value="${order.quantity}">
		    <input type="hidden" name="userId" th:if="${user != null}" th:value="${user.id}" />

		    <h2>ðŸ›’ Order Summary</h2>
		    <p class="order-detail">Product Name: <span th:text="${order.product.name}"></span></p>
		    <p class="order-detail">Price per unit: â‚¹<span th:text="${order.product.price}"></span></p>
		    <p class="order-detail">Quantity: <span th:text="${order.quantity}"></span></p>
		    <p class="order-detail">Total Amount: â‚¹<span th:text="${order.amount}"></span></p>

		    <div th:if="${base64Image != ''}">
		        <img class="product-image" th:src="'data:image/png;base64,' + ${base64Image}" alt="Product Image" width="200"/>
		    </div>

		    <textarea name="address" placeholder="Enter delivery address..." required></textarea>

			<div class="payment-options">
			                <h3>Select Payment Method</h3>
			                <label>
			                    <input type="radio" name="paymentMethod" value="COD" required>
			                    Cash on Delivery
			                </label>
			                <label>
			                    <input type="radio" name="paymentMethod" value="ONLINE" id="payOnlineRadio">
			                    Pay Online
			                </label>
			            </div>

			<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
			<script>
			document.getElementById("payOnlineRadio").onclick = function () {
			    const amount = /*[[${order.amount}]]*/ 100; // dynamic from Thymeleaf if available

			    fetch("/payment/create-order", {
			        method: "POST",
			        headers: {"Content-Type": "application/json"},
			        body: JSON.stringify({ amount: amount })
			    })
			    .then(res => res.json())
			    .then(order => {
			        var options = {
			            "key": "rzp_test_RQBwjAAlj0ws3j", // your test key
			            "amount": order.amount,
			            "currency": "INR",
			            "name": "E-Commerce App",
			            "description": "Order Payment",
			            "order_id": order.id,
			            "handler": function (response) {
			                fetch("/payment/success", {
			                    method: "POST",
			                    headers: {"Content-Type": "application/x-www-form-urlencoded"},
			                    body: new URLSearchParams(response)
			                }).then(() => window.location.href = "/order-success");
			            },
			            "theme": {"color": "#3399cc"}
			        };
			        var rzp = new Razorpay(options);
			        rzp.open();
			    });
			};
			</script>
			<br><br>
		    <button type="submit">Proceed to Payment</button>
		</form>
    </div>
</body>
</html>
